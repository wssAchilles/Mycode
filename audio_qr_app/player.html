<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³é¢‘æ’­æ”¾å™¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        .container {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 20px;
            padding: 40px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); max-width: 500px; width: 100%; text-align: center;
        }
        .loading { display: block; }
        .content { display: none; }
        .title { font-size: 28px; color: #2c3e50; margin-bottom: 10px; font-weight: 700; }
        .subtitle { color: #7f8c8d; font-size: 14px; margin-bottom: 25px; }
        .filename {
            color: #34495e; margin-bottom: 25px; padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px; word-break: break-all; font-size: 16px; font-weight: 500;
            border-left: 4px solid #667eea;
        }
        .audio-container {
            margin-bottom: 25px; padding: 20px; background: #f8f9fa;
            border-radius: 15px; border: 2px dashed #dee2e6;
        }
        .audio-player { width: 100%; border-radius: 12px; outline: none; }
        .button-group { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; margin-bottom: 20px; }
        .btn {
            display: inline-flex; align-items: center; justify-content: center; text-decoration: none;
            padding: 14px 24px; border-radius: 25px; font-weight: 600; font-size: 16px;
            transition: all 0.3s ease; border: none; cursor: pointer; min-width: 120px; gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2); color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: linear-gradient(45deg, #28a745, #20c997); color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6); }
        .tips {
            margin-top: 20px; color: #6c757d; font-size: 14px; line-height: 1.8;
            padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 3px solid #17a2b8;
        }
        .debug-info {
            margin-top: 20px; padding: 15px; background: #f1f3f4; border-radius: 10px;
            font-family: monospace; font-size: 12px; text-align: left; max-height: 200px;
            overflow-y: auto; border: 1px solid #dee2e6;
        }
        .error-message, .success-message {
            padding: 15px; border-radius: 10px; margin-top: 15px; border: 1px solid;
        }
        .error-message { background: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .success-message { background: #d4edda; color: #155724; border-color: #c3e6cb; display: none; }
        .spinner {
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-top: 3px solid #667eea;
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite; margin: 0 auto 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @media (max-width: 480px) {
            .container { padding: 25px 20px; }
            .title { font-size: 24px; }
            .filename { font-size: 14px; padding: 12px; }
            .btn { padding: 12px 20px; font-size: 14px; min-width: 100px; }
            .button-group { flex-direction: column; align-items: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- åŠ è½½çŠ¶æ€ -->
        <div class="loading" id="loadingDiv">
            <div class="spinner"></div>
            <h2 class="title">ğŸµ éŸ³é¢‘æ’­æ”¾å™¨</h2>
            <p class="subtitle">æ­£åœ¨åŠ è½½éŸ³é¢‘ä¿¡æ¯...</p>
            <p id="loadingStatus">è§£æURLå‚æ•°ä¸­...</p>
        </div>
        
        <!-- æ’­æ”¾å™¨å†…å®¹ -->
        <div class="content" id="contentDiv">
            <h1 class="title">ğŸµ</h1>
            <p class="subtitle">éŸ³é¢‘æ’­æ”¾å™¨</p>
            <div class="filename" id="filenameDisplay">éŸ³é¢‘æ–‡ä»¶</div>
            <div class="audio-container">
                <audio class="audio-player" id="audioPlayer" controls preload="auto">
                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾åŠŸèƒ½ã€‚
                </audio>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" id="playBtn" onclick="togglePlay()">
                    <span id="playText">æ’­æ”¾</span>
                </button>
                <a href="#" class="btn btn-secondary" id="downloadBtn" target="_blank">
                    ğŸ“¥ ä¸‹è½½éŸ³é¢‘
                </a>
            </div>
            
            <div class="tips">
                ğŸ’¡ <strong>éŸ³é¢‘æ’­æ”¾å™¨</strong><br>
                â€¢ æ”¯æŒåœ¨çº¿æ’­æ”¾å’Œä¸‹è½½<br>
                â€¢ éŸ³é¢‘ä¿¡æ¯å·²è‡ªåŠ¨åŠ è½½<br>
                â€¢ å»ºè®®åœ¨WiFiç¯å¢ƒä¸‹ä½¿ç”¨ä»¥èŠ‚çœæµé‡
            </div>
        </div>
        
        <div class="error-message" id="errorMessage" style="display: none;"></div>
        <div class="success-message" id="successMessage"></div>
        <div class="debug-info" id="debugInfo"></div>
    </div>

    <script>
        let audioPlayer = null, isPlaying = false;
        const elements = {
            loadingDiv: document.getElementById('loadingDiv'),
            contentDiv: document.getElementById('contentDiv'),
            loadingStatus: document.getElementById('loadingStatus'),
            audioPlayer: document.getElementById('audioPlayer'),
            filenameDisplay: document.getElementById('filenameDisplay'),
            playText: document.getElementById('playText'),
            downloadBtn: document.getElementById('downloadBtn'),
            errorMessage: document.getElementById('errorMessage'),
            successMessage: document.getElementById('successMessage'),
            debugInfo: document.getElementById('debugInfo')
        };

        // é¡µé¢åŠ è½½å®Œæˆåç«‹å³åˆå§‹åŒ–
        (function() {
            updateLoadingStatus('å¼€å§‹è§£æéŸ³é¢‘å‚æ•°...');
            addDebugInfo('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–');
            
            setTimeout(() => {
                initializePlayer();
            }, 500);
        })();

        function updateLoadingStatus(message) {
            elements.loadingStatus.textContent = message;
            addDebugInfo('çŠ¶æ€: ' + message);
        }

        function initializePlayer() {
            try {
                updateLoadingStatus('è§£æURLå‚æ•°...');
                
                // è·å–URLå‚æ•°
                const urlParams = new URLSearchParams(window.location.search);
                const dataParam = urlParams.get('data');
                
                if (dataParam) {
                    updateLoadingStatus('æ‰¾åˆ°éŸ³é¢‘å‚æ•°ï¼Œè§£æä¸­...');
                    
                    // è§£æå‚æ•°
                    const jsonString = atob(dataParam);
                    const params = JSON.parse(jsonString);
                    
                    const audioData = {
                        filename: params.title || params.f || params.n || 'éŸ³é¢‘æ–‡ä»¶',
                        audioUrl: params.src || params.u || params.source
                    };
                    
                    addDebugInfo('éŸ³é¢‘æ•°æ®è§£ææˆåŠŸ: ' + JSON.stringify(audioData));
                    
                    if (audioData.audioUrl) {
                        updateLoadingStatus('éŸ³é¢‘ä¿¡æ¯åŠ è½½å®Œæˆï¼');
                        setupPlayer(audioData);
                        showPlayer();
                    } else {
                        throw new Error('éŸ³é¢‘URLä¸ºç©º');
                    }
                    
                } else {
                    throw new Error('æœªæ‰¾åˆ°éŸ³é¢‘å‚æ•°');
                }
                
            } catch (e) {
                addDebugInfo('åˆå§‹åŒ–å¤±è´¥: ' + e.message);
                showError('åŠ è½½å¤±è´¥: ' + e.message);
                
                // æ˜¾ç¤ºæ‰‹åŠ¨è¾“å…¥é€‰é¡¹
                setTimeout(() => {
                    showManualInput();
                }, 2000);
            }
        }

        function setupPlayer(audioData) {
            elements.audioPlayer.src = audioData.audioUrl;
            elements.filenameDisplay.textContent = audioData.filename;
            elements.downloadBtn.href = audioData.audioUrl;
            elements.downloadBtn.download = audioData.filename;
            
            audioPlayer = elements.audioPlayer;
            setupAudioEventListeners();
            
            addDebugInfo('æ’­æ”¾å™¨è®¾ç½®å®Œæˆ');
        }

        function showPlayer() {
            elements.loadingDiv.style.display = 'none';
            elements.contentDiv.style.display = 'block';
            addDebugInfo('æ’­æ”¾å™¨ç•Œé¢å·²æ˜¾ç¤º');
        }

        function setupAudioEventListeners() {
            if (!audioPlayer) return;
            
            audioPlayer.addEventListener('play', () => {
                isPlaying = true;
                elements.playText.textContent = 'æš‚åœ';
                addDebugInfo('éŸ³é¢‘å¼€å§‹æ’­æ”¾');
            });
            
            audioPlayer.addEventListener('pause', () => {
                isPlaying = false;
                elements.playText.textContent = 'æ’­æ”¾';
                addDebugInfo('éŸ³é¢‘æš‚åœ');
            });
            
            audioPlayer.addEventListener('error', (e) => {
                showError('éŸ³é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                addDebugInfo('éŸ³é¢‘é”™è¯¯: ' + e.message);
            });
        }

        function togglePlay() {
            if (!audioPlayer) return;
            
            if (isPlaying) {
                audioPlayer.pause();
            } else {
                audioPlayer.play().catch(error => {
                    console.error('æ’­æ”¾å¤±è´¥:', error);
                    showError('æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶æˆ–ç½‘ç»œè¿æ¥');
                });
            }
        }

        function showError(message) {
            elements.errorMessage.style.display = 'block';
            elements.errorMessage.textContent = message;
            addDebugInfo('é”™è¯¯: ' + message);
        }

        function addDebugInfo(message) {
            const timestamp = new Date().toLocaleTimeString();
            const debugLine = timestamp + ': ' + message;
            
            elements.debugInfo.innerHTML += debugLine + '<br>';
            elements.debugInfo.scrollTop = elements.debugInfo.scrollHeight;
            
            console.log(debugLine);
        }

        function showManualInput() {
            elements.loadingDiv.innerHTML = `
                <h2 class="title">ğŸ“ æ‰‹åŠ¨è¾“å…¥</h2>
                <p class="subtitle">æ— æ³•è‡ªåŠ¨åŠ è½½ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥éŸ³é¢‘ä¿¡æ¯ï¼š</p>
                <div style="margin: 20px 0;">
                    <input type="text" id="manualAudioUrl" placeholder="è¾“å…¥éŸ³é¢‘URL" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <input type="text" id="manualFileName" placeholder="è¾“å…¥æ–‡ä»¶å" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <button onclick="loadManualInput()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%;">åŠ è½½éŸ³é¢‘</button>
                </div>
            `;
        }

        function loadManualInput() {
            const audioUrl = document.getElementById('manualAudioUrl').value.trim();
            const fileName = document.getElementById('manualFileName').value.trim() || 'æ‰‹åŠ¨è¾“å…¥éŸ³é¢‘';
            
            addDebugInfo('æ‰‹åŠ¨è¾“å…¥ - URL: ' + audioUrl + ', æ–‡ä»¶å: ' + fileName);
            
            if (audioUrl) {
                // éªŒè¯URLæ ¼å¼
                try {
                    new URL(audioUrl);
                    const audioData = { filename: fileName, audioUrl: audioUrl };
                    setupPlayer(audioData);
                    showPlayer();
                    addDebugInfo('æ‰‹åŠ¨è¾“å…¥åŠ è½½æˆåŠŸ');
                    
                    // æ¸…é™¤é”™è¯¯ä¿¡æ¯
                    elements.errorMessage.style.display = 'none';
                } catch (e) {
                    addDebugInfo('URLæ ¼å¼é”™è¯¯: ' + e.message);
                    showError('è¯·è¾“å…¥æœ‰æ•ˆçš„éŸ³é¢‘URLï¼ˆéœ€è¦åŒ…å«http://æˆ–https://ï¼‰');
                }
            } else {
                showError('è¯·è¾“å…¥éŸ³é¢‘URL');
            }
        }
    </script>
</body>
</html>
