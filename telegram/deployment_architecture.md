# ğŸš€ Telegram Clone äº‘ç«¯éƒ¨ç½²æ¶æ„è¯¦è§£

## ğŸ“ æœåŠ¡éƒ¨ç½²åœ°å€

| æœåŠ¡ | å¹³å° | éƒ¨ç½²åœ°å€ | çŠ¶æ€ |
| :--- | :--- | :--- | :--- |
| **å‰ç«¯åº”ç”¨** | Vercel | https://telegram-liart-rho.vercel.app | âœ… è¿è¡Œä¸­ |
| **åç«¯ API** | Render | https://telegram-clone-backend-88ez.onrender.com | âœ… è¿è¡Œä¸­ |
| **PostgreSQL** | Supabase | é€šè¿‡ Connection Pooler è¿æ¥ | âœ… è¿æ¥æ­£å¸¸ |
| **MongoDB** | MongoDB Atlas | äº‘æ‰˜ç®¡ | âœ… è¿æ¥æ­£å¸¸ |
| **Redis** | Upstash | äº‘æ‰˜ç®¡ | âœ… è¿æ¥æ­£å¸¸ |

---

## ğŸ”„ å‰åç«¯äº¤äº’æµç¨‹å›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·æµè§ˆå™¨
    participant Frontend as å‰ç«¯ (Vercel)
    participant Backend as åç«¯ (Render)
    participant Gemini as Google Gemini API
    participant DB as æ•°æ®åº“æœåŠ¡

    User->>Frontend: è®¿é—® https://telegram-liart-rho.vercel.app
    Frontend->>User: è¿”å›é™æ€èµ„æº (HTML/CSS/JS)
    
    Note over User,Frontend: ç”¨æˆ·ç™»å½•æµç¨‹
    User->>Frontend: è¾“å…¥ç”¨æˆ·åå¯†ç 
    Frontend->>Backend: POST /api/auth/login
    Backend->>DB: éªŒè¯ç”¨æˆ·å‡­æ® (PostgreSQL)
    DB-->>Backend: è¿”å›ç”¨æˆ·ä¿¡æ¯
    Backend-->>Frontend: è¿”å› JWT Token
    Frontend-->>User: ç™»å½•æˆåŠŸï¼Œä¿å­˜ Token

    Note over User,Backend: AI èŠå¤©æµç¨‹ (HTTP æ¨¡å¼)
    User->>Frontend: å‘é€ AI æ¶ˆæ¯
    Frontend->>Frontend: ä¹è§‚æ›´æ–° UI (æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯)
    Frontend->>Backend: POST /api/ai/chat (å¸¦ Token)
    Backend->>Gemini: è°ƒç”¨ Gemini 2.0 Flash API
    Gemini-->>Backend: è¿”å› AI å›å¤
    Backend-->>Frontend: è¿”å› AI æ¶ˆæ¯å†…å®¹
    Frontend-->>User: æ˜¾ç¤º AI å›å¤
```

---

## ğŸŒ ç¯å¢ƒå˜é‡é…ç½®

### å‰ç«¯ (Vercel ç¯å¢ƒå˜é‡)

| å˜é‡å | å€¼ | è¯´æ˜ |
| :--- | :--- | :--- |
| `VITE_API_BASE_URL` | `https://telegram-clone-backend-88ez.onrender.com` | åç«¯ API åŸºç¡€åœ°å€ |
| `VITE_SOCKET_URL` | `wss://telegram-clone-backend-88ez.onrender.com` | WebSocket åœ°å€ (ç”Ÿäº§ç¯å¢ƒç¦ç”¨) |

### åç«¯ (Render ç¯å¢ƒå˜é‡)

| å˜é‡å | è¯´æ˜ | é…ç½®æ–¹å¼ |
| :--- | :--- | :--- |
| `NODE_ENV` | `production` | render.yaml é¢„è®¾ |
| `PORT` | `10000` | render.yaml é¢„è®¾ |
| `DATABASE_URL` | Supabase PostgreSQL è¿æ¥å­—ç¬¦ä¸² | Dashboard æ‰‹åŠ¨è®¾ç½® |
| `MONGODB_URI` | MongoDB Atlas è¿æ¥å­—ç¬¦ä¸² | Dashboard æ‰‹åŠ¨è®¾ç½® |
| `REDIS_URL` | Upstash Redis è¿æ¥å­—ç¬¦ä¸² | Dashboard æ‰‹åŠ¨è®¾ç½® |
| `JWT_SECRET` | JWT ç­¾åå¯†é’¥ | Dashboard æ‰‹åŠ¨è®¾ç½® |
| `GEMINI_API_KEY` | Google AI Studio API Key | Dashboard æ‰‹åŠ¨è®¾ç½® |
| `NODE_OPTIONS` | `--dns-result-order=ipv4first` | render.yaml é¢„è®¾ |

---

## ğŸ“¡ API ç«¯ç‚¹åˆ—è¡¨

### è®¤è¯æ¨¡å— `/api/auth`

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ | é‰´æƒ |
| :--- | :--- | :--- | :--- |
| POST | `/register` | ç”¨æˆ·æ³¨å†Œ | âŒ |
| POST | `/login` | ç”¨æˆ·ç™»å½• | âŒ |
| POST | `/refresh` | åˆ·æ–° Token | âŒ |
| GET | `/me` | è·å–å½“å‰ç”¨æˆ· | âœ… |

### AI æ¨¡å— `/api/ai`

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ | é‰´æƒ |
| :--- | :--- | :--- | :--- |
| POST | `/chat` | å‘é€æ¶ˆæ¯ç»™ AI | âœ… |
| GET | `/health` | AI æœåŠ¡å¥åº·æ£€æŸ¥ | âœ… |
| GET | `/info` | è·å– AI æœåŠ¡ä¿¡æ¯ | âœ… |

### æ¶ˆæ¯æ¨¡å— `/api/messages`

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ | é‰´æƒ |
| :--- | :--- | :--- | :--- |
| GET | `/conversation/:receiverId` | è·å–ç§èŠè®°å½• | âœ… |
| GET | `/group/:groupId` | è·å–ç¾¤èŠè®°å½• | âœ… |
| POST | `/send` | å‘é€æ¶ˆæ¯ | âœ… |
| PUT | `/read` | æ ‡è®°æ¶ˆæ¯å·²è¯» | âœ… |
| DELETE | `/:messageId` | åˆ é™¤æ¶ˆæ¯ | âœ… |
| GET | `/unread-count` | è·å–æœªè¯»æ•° | âœ… |

### è”ç³»äººæ¨¡å— `/api/contacts`

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ | é‰´æƒ |
| :--- | :--- | :--- | :--- |
| GET | `/` | è·å–è”ç³»äººåˆ—è¡¨ | âœ… |
| POST | `/add` | æ·»åŠ è”ç³»äºº | âœ… |
| GET | `/pending-requests` | è·å–å¾…å¤„ç†è¯·æ±‚ | âœ… |
| PUT | `/requests/:requestId` | å¤„ç†è”ç³»äººè¯·æ±‚ | âœ… |
| DELETE | `/:contactId` | åˆ é™¤è”ç³»äºº | âœ… |
| GET | `/search` | æœç´¢ç”¨æˆ· | âœ… |

### ç¾¤ç»„æ¨¡å— `/api/groups`

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ | é‰´æƒ |
| :--- | :--- | :--- | :--- |
| POST | `/` | åˆ›å»ºç¾¤ç»„ | âœ… |
| GET | `/my` | è·å–æˆ‘çš„ç¾¤ç»„ | âœ… |
| GET | `/:groupId` | è·å–ç¾¤ç»„è¯¦æƒ… | âœ… |
| PUT | `/:groupId` | æ›´æ–°ç¾¤ç»„ | âœ… |
| DELETE | `/:groupId` | åˆ é™¤ç¾¤ç»„ | âœ… |
| POST | `/:groupId/members` | æ·»åŠ æˆå‘˜ | âœ… |
| DELETE | `/:groupId/members/:memberId` | ç§»é™¤æˆå‘˜ | âœ… |
| POST | `/:groupId/leave` | é€€å‡ºç¾¤ç»„ | âœ… |

### æ–‡ä»¶ä¸Šä¼  `/api`

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ | é‰´æƒ |
| :--- | :--- | :--- | :--- |
| POST | `/upload` | ä¸Šä¼ æ–‡ä»¶ | âœ… |
| GET | `/uploads/:filename` | ä¸‹è½½æ–‡ä»¶ | âŒ |
| GET | `/uploads/thumbnails/:filename` | è·å–ç¼©ç•¥å›¾ | âŒ |

---

## ğŸ”’ è®¤è¯æœºåˆ¶

### JWT Token æµç¨‹

```
1. ç”¨æˆ·ç™»å½• â†’ åç«¯è¿”å› accessToken + refreshToken
2. å‰ç«¯å­˜å‚¨ Token åˆ° localStorage
3. æ¯æ¬¡è¯·æ±‚è‡ªåŠ¨åœ¨ Header æ·»åŠ : Authorization: Bearer <accessToken>
4. Token è¿‡æœŸæ—¶ï¼Œä½¿ç”¨ refreshToken è‡ªåŠ¨åˆ·æ–°
```

### Token å­˜å‚¨ä½ç½® (å‰ç«¯)

```javascript
localStorage.setItem('accessToken', token);
localStorage.setItem('refreshToken', refreshToken);
```

---

## ğŸ“¦ æ•°æ®åº“æ¶æ„

| æ•°æ®åº“ | ç”¨é€” | å­˜å‚¨å†…å®¹ |
| :--- | :--- | :--- |
| **PostgreSQL** | ä¸»æ•°æ®åº“ | ç”¨æˆ·ã€è”ç³»äººã€ç¾¤ç»„ã€æ¶ˆæ¯å…ƒæ•°æ® |
| **MongoDB** | æ–‡æ¡£å­˜å‚¨ | æ¶ˆæ¯å†…å®¹ã€æ–‡ä»¶å…ƒæ•°æ® |
| **Redis** | ç¼“å­˜ | ä¼šè¯ã€åœ¨çº¿çŠ¶æ€ã€å®æ—¶æ•°æ® |

---

## âš™ï¸ ç‰¹æ®Šé…ç½®è¯´æ˜

### 1. IPv4 ä¼˜å…ˆ (è§£å†³ Supabase è¿æ¥é—®é¢˜)

```yaml
# render.yaml
NODE_OPTIONS: "--dns-result-order=ipv4first"
```

### 2. AI Socket ç¦ç”¨

ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå‡ºäºç¨³å®šæ€§è€ƒè™‘ï¼Œåç«¯çš„ AI Socket.IO æœåŠ¡è¢«ç¦ç”¨ã€‚å‰ç«¯ä¼šè‡ªåŠ¨é™çº§ä½¿ç”¨ HTTP APIï¼š

```
AI_SOCKET_ENABLED=false (Render é»˜è®¤)
```

å‰ç«¯æ£€æµ‹åˆ° Socket ä¸å¯ç”¨æ—¶ï¼Œä¼šé€šè¿‡ `/api/ai/chat` HTTP ç«¯ç‚¹é€šä¿¡ã€‚

### 3. CORS ç™½åå•

åç«¯å·²é…ç½®å…è®¸çš„å‰ç«¯åŸŸåï¼š

```typescript
// cors.ts
const allowedOrigins = [
  'https://telegram-liart-rho.vercel.app',
  /\.vercel\.app$/
];
```

---

## ğŸ§ª API è°ƒç”¨ç¤ºä¾‹

### ç”¨æˆ·ç™»å½•

```bash
curl -X POST https://telegram-clone-backend-88ez.onrender.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "testuser", "password": "password123"}'
```

### AI èŠå¤©

```bash
curl -X POST https://telegram-clone-backend-88ez.onrender.com/api/ai/chat \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{"message": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±"}'
```

---

## ğŸ“Š éƒ¨ç½²æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·æµè§ˆå™¨                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTPS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vercel (å‰ç«¯æ‰˜ç®¡)                             â”‚
â”‚  https://telegram-liart-rho.vercel.app                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  React + TypeScript + Vite                                  â”‚â”‚
â”‚  â”‚  - apiClient.ts â†’ å°è£… Axios è¯·æ±‚                           â”‚â”‚
â”‚  â”‚  - socketService.ts â†’ Socket.IO å®¢æˆ·ç«¯                      â”‚â”‚
â”‚  â”‚  - aiSocketService.ts â†’ AI Socket + HTTP å›é€€               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTPS API è°ƒç”¨
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Render (åç«¯æ‰˜ç®¡)                             â”‚
â”‚  https://telegram-clone-backend-88ez.onrender.com               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Node.js + Express + TypeScript                             â”‚â”‚
â”‚  â”‚  è·¯ç”±: /api/auth, /api/messages, /api/ai, /api/contacts...  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase    â”‚ â”‚ MongoDB Atlas â”‚ â”‚    Upstash    â”‚
â”‚  PostgreSQL   â”‚ â”‚   Documents   â”‚ â”‚     Redis     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Gemini API è°ƒç”¨
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Google Gemini    â”‚
â”‚  (gemini-2.0-flash)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2026-01-20*
